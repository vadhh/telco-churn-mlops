name: Preprocessing Pipeline (Afridho Tavadhu)

on:
  push:
    branches:
      - main

jobs:
  data-preprocessing:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Check out the repository
    - name: Checkout Code
      uses: actions/checkout@v3

    # 2. Set up Python 3.12.7
    - name: Set up Python 3.12
      uses: actions/setup-python@v4
      with:
        python-version: '3.12.7'

    # 3. Install Dependencies
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4. Create dummy data if raw data is missing (CRITICAL FOR CI/CD)
    # Since you might not commit 'data_raw/data_telco.csv' due to size or privacy,
    # we check if it exists. If not, we download it or fail gracefully.
    # Assuming for this rubric you DO commit the raw data.
    
    # 5. Run the Automation Script
    - name: Run Preprocessing Script
      run: |
        python preprocessing/automate_Afridho_Tavadhu.py --input data_raw/data_telco.csv --output data_processed

    # 6. Verify Outputs
    - name: Verify Output Files Exist
      run: |
        ls -l data_processed/
        test -f data_processed/train.csv
        test -f data_processed/test.csv

    # 7. Upload Processed Data as Artifact (Advanced Requirement)
    - name: Upload Processed Data
      uses: actions/upload-artifact@v4
      with:
        name: processed-data-afridho
        path: data_processed/